{"ast":null,"code":"import _asyncToGenerator from \"D:/Laragon/www/Osem-Salmon-PRS/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport { getAuth, updateEmail } from '@firebase/auth';\nimport { ref } from 'vue';\nimport getUserAuth from '../composables/getUserAuth';\nimport getCollection from '../composables/getCollection';\nexport default {\n  setup: function setup() {\n    var auth = getAuth();\n\n    var _getUserAuth = getUserAuth(),\n        userAuth = _getUserAuth.userAuth;\n\n    var user = auth.currentUser;\n    console.log(userAuth.value.uid);\n    var error = ref(null);\n    var email = ref(\"\");\n    var emailRepeat = ref(\"\");\n\n    var _getCollection = getCollection(\"staff\", [\"uid\", \"==\", userAuth.value.uid]),\n        staff = _getCollection.documents;\n\n    var handleSubmit = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var docRef;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n\n                if (!(email.value == emailRepeat.value)) {\n                  _context.next = 12;\n                  break;\n                }\n\n                _context.next = 4;\n                return updateEmail(user, email.value);\n\n              case 4:\n                email.value = \"\";\n                emailRepeat.value = \"\";\n                alert(\"Email updated!\");\n                docRef = doc(db, 'staff', staff.id);\n                updateDoc(docRef, {\n                  email: staff.email\n                });\n                alert(\"Email updated!\");\n                _context.next = 13;\n                break;\n\n              case 12:\n                if (password.value != passwordRepeat.value) {\n                  alert(\"Email does not match!\");\n                }\n\n              case 13:\n                _context.next = 18;\n                break;\n\n              case 15:\n                _context.prev = 15;\n                _context.t0 = _context[\"catch\"](0);\n                error.value = _context.t0.message;\n\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 15]]);\n      }));\n\n      return function handleSubmit() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    return {\n      handleSubmit: handleSubmit,\n      email: email,\n      emailRepeat: emailRepeat,\n      error: error,\n      userAuth: userAuth\n    };\n  }\n};","map":{"version":3,"sources":["D:\\Laragon\\www\\Osem-Salmon-PRS\\src\\components\\editUserEmail.vue"],"names":[],"mappings":";;AAyBA,SAAS,OAAT,EAAkB,WAAlB,QAAqC,gBAArC;AACA,SAAS,GAAT,QAAoB,KAApB;AACA,OAAO,WAAP,MAAwB,4BAAxB;AACA,OAAO,aAAP,MAA0B,8BAA1B;AAEA,eAAe;EACX,KADW,mBACH;IAEJ,IAAM,IAAG,GAAI,OAAO,EAApB;;IACA,mBAAqB,WAAW,EAAhC;IAAA,IAAQ,QAAR,gBAAQ,QAAR;;IACA,IAAM,IAAG,GAAI,IAAI,CAAC,WAAlB;IACA,OAAO,CAAC,GAAR,CAAY,QAAQ,CAAC,KAAT,CAAe,GAA3B;IACA,IAAM,KAAI,GAAI,GAAG,CAAC,IAAD,CAAjB;IAEA,IAAM,KAAI,GAAI,GAAG,CAAC,EAAD,CAAjB;IACA,IAAM,WAAU,GAAI,GAAG,CAAC,EAAD,CAAvB;;IAEA,qBAA6B,aAAa,CAAC,OAAD,EAAU,CAAC,KAAD,EAAQ,IAAR,EAAc,QAAQ,CAAC,KAAT,CAAe,GAA7B,CAAV,CAA1C;IAAA,IAAmB,KAAnB,kBAAQ,SAAR;;IAEA,IAAM,YAAW;MAAA,mEAAI;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;;gBAAA,MAET,KAAK,CAAC,KAAN,IAAe,WAAW,CAAC,KAFlB;kBAAA;kBAAA;gBAAA;;gBAAA;gBAAA,OAIH,WAAW,CAAC,IAAD,EAAO,KAAK,CAAC,KAAb,CAJR;;cAAA;gBAKT,KAAK,CAAC,KAAN,GAAc,EAAd;gBACA,WAAW,CAAC,KAAZ,GAAoB,EAApB;gBACA,KAAK,CAAC,gBAAD,CAAL;gBAEM,MATG,GASM,GAAG,CAAC,EAAD,EAAK,OAAL,EAAc,KAAK,CAAC,EAApB,CATT;gBAUT,SAAS,CAAC,MAAD,EAAS;kBAAE,KAAK,EAAE,KAAK,CAAC;gBAAf,CAAT,CAAT;gBACA,KAAK,CAAC,gBAAD,CAAL;gBAXS;gBAAA;;cAAA;gBAcR,IAAI,QAAQ,CAAC,KAAT,IAAkB,cAAc,CAAC,KAArC,EACL;kBACI,KAAK,CAAC,uBAAD,CAAL;gBACJ;;cAjBa;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA;gBAsBb,KAAK,CAAC,KAAN,GAAc,YAAI,OAAlB;;cAtBa;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CAAJ;;MAAA,gBAAX,YAAW;QAAA;MAAA;IAAA,GAAjB;;IA6BA,OAAO;MACH,YAAY,EAAZ,YADG;MAEH,KAAK,EAAL,KAFG;MAGH,WAAW,EAAX,WAHG;MAIH,KAAK,EAAL,KAJG;MAKH,QAAO,EAAP;IALG,CAAP;EAOJ;AAlDW,CAAf","sourcesContent":["<template>\r\n<form @submit.prevent=\"handleSubmit\">\r\n    <div class=\"form-floating mb-3\">\r\n        <input type=\"email\" class=\"form-control\" id=\"floatingPassword\" placeholder=\"Password\" v-model=\"email\">\r\n        <label for=\"floatingPassword\">Email</label>\r\n    </div>\r\n\r\n    <div class=\"form-floating mb-3\">\r\n        <input type=\"email\" class=\"form-control\" id=\"floatingPassword\" placeholder=\"Password\" v-model=\"emailRepeat\">\r\n        <label for=\"floatingPassword\">Repeat Email</label>\r\n        <div class=\"form-text\">Security-sensitive actions may require user to re-login before updating.</div>\r\n    </div>\r\n    <div v-if=\"error\">\r\n            <h6><small class=\"text-muted\">{{ error }}</small></h6>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\r\n        <button class=\"btn btn-primary\">Update</button>\r\n    </div>    \r\n</form>\r\n  \r\n\r\n</template>\r\n\r\n<script>\r\nimport { getAuth, updateEmail } from '@firebase/auth'\r\nimport { ref } from 'vue'\r\nimport getUserAuth from '../composables/getUserAuth'\r\nimport getCollection from '../composables/getCollection'\r\n\r\nexport default {\r\n    setup() {\r\n\r\n        const auth = getAuth()\r\n        const { userAuth } = getUserAuth()\r\n        const user = auth.currentUser\r\n        console.log(userAuth.value.uid)\r\n        const error = ref(null)\r\n\r\n        const email = ref(\"\")\r\n        const emailRepeat = ref(\"\")\r\n\r\n        const { documents: staff } = getCollection(\"staff\", [\"uid\", \"==\", userAuth.value.uid])\r\n\r\n        const handleSubmit = async () => {\r\n            try {\r\n                if (email.value == emailRepeat.value) \r\n                {\r\n                    await updateEmail(user, email.value)\r\n                    email.value = \"\"\r\n                    emailRepeat.value = \"\"\r\n                    alert(\"Email updated!\")\r\n\r\n                    const docRef = doc(db, 'staff', staff.id)\r\n                    updateDoc(docRef, { email: staff.email })\r\n                    alert(\"Email updated!\")\r\n                } \r\n            \r\n                else if (password.value != passwordRepeat.value) \r\n                {\r\n                    alert(\"Email does not match!\")\r\n                }\r\n            } \r\n            \r\n            catch (err) \r\n            {\r\n                error.value = err.message\r\n            }\r\n            \r\n        }\r\n\r\n        \r\n\r\n        return {\r\n            handleSubmit,\r\n            email,\r\n            emailRepeat,\r\n            error,\r\n            userAuth\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"],"sourceRoot":""},"metadata":{},"sourceType":"module"}